<!doctype html>
<html lang="en-AU">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QSKP9BY28S"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-QSKP9BY28S');
  </script>
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
	<title>Unnamed Chat</title>
	<style>
		body {
			font-size: 18px;
			background-color: #3c3c3c;
			color: white;
      margin: 0px;
		}

		body,
		input,
		button {
			font-family: Roboto, sans-serif;
		}

		body,
		html {
			height: 100%;
		}

		#msgBox {
      font-size: 18px;
			border-radius: 5px;
			color: white;
			padding: 15px 10px;
			width: calc(100% - 624px);
			background-color: #2f2f2f;
			outline: 0px !important;
			position: absolute;
			left: 330px;
			bottom: 10px;
			height: 24px;
      border: 0px;
      display: inline-block;
      border: 2px solid #232323;
    }

    #msgBox:focus {
			border: 2px solid #fda50f;
		}

		#messages {
      padding: 0px 15px;
			height: calc(100% - 100px) !important;
      width: calc(100% - 600px);
			overflow: auto;
      position: absolute;
      left: 320px;
      word-wrap:break-word;
		}

		/*custom scroll*/
		*::-webkit-scrollbar {
			width: 10px;
		}
		*::-webkit-scrollbar-thumb {
			background-color: #232323;
			border-radius: 16px;
		}
		*::-webkit-scrollbar-button {
			display: none;
		}

    #promoteMenu::-webkit-scrollbar-thumb, #moreActionsMenu::-webkit-scrollbar-thumb {
			background-color: #2f2f2f;
    }
    .msgBox {
      font-size: 13px;
      margin: 10px 0px;
      background-color: #232323;
      border-radius: 5px;
      width: 440px;
      padding: 10px 15px 15px 15px;
      min-height: 110px;
    }

    .msgBox > .title {
      margin: 0px;
      margin-bottom: 10px;
      font-size: 20px;
      font-weight: bold;
      width: 100%;
    }

    .msgBox * {
      display: inline-block;
      width: 320px;
      margin: 2px;
    }

    .msgBox img {
      margin: 0px 10px 10px 0px;
      float: left;
      vertical-align: bottom;
    }
    .msgBox img, .imgRound {
      display: inline-block;
      width: 80px;
      height: 80px;
      border-radius: 50%;
    }
    .channelLabel, .settingsTab, .add, .tabLabel {
			background-color: #2f2f2f;
			border-radius: 10px;
			margin: 10px;
			padding: 3px;
			text-align: center;
			cursor: pointer;
			border: 2px solid #2f2f2f;
		}
    .sidebar {
			position: absolute;
			left: 0px;
			top: 0px;
			width: 250px;
			height: 100% !important;
			background-color: #232323;
      overflow: auto;
		}
    #mainSidebar {
      left: 70px;
    }
    .sideTitle {
      margin: 10px;
      font-weight: bold;
      font-size: 20px;
    }
    .profilePic {
      border-radius: 50%;
      color: white;
      height: 40px;
      width: 40px;
      float: left;
    }
    .newSender {
      min-height: 40px;
      padding-top: 10px;
    }
    .topLine, .messageText {
      margin-left: 55px;
    }
    #userList {
      width: 250px;
      position: absolute;
      background-color: #232323;
      height: 100%;
      right: 0px;
    }
    #userList > div {
      margin: 15px;
      height: 32px;
    }
    #userList > div > span {
      margin-top: 5px;
      margin-left: 10px;
      display: inline-block;
    }
    .userListImg {
      width: 32px;
      height: 32px;
      float: left;
      vertical-align: middle;
      border-radius: 50%;
    }
    #userOptions {
      position: absolute;
      bottom: 0px;
      left: 0px;
      width: 230px;
      height: 30px;
      padding: 10px;
      background-color: #191919;
    }
    #userSettingsBtn {
      display: inline-block;
      cursor: pointer;
      width: 20px;
      height: 20px;
      position: absolute;
      top: 15px;
      right: 15px;
    }
    #userSettings {
      width: 100%;
      height: 100%;
      background-color: #3c3c3c;
      display: none;
      z-index: 30;
      position: absolute;
      overflow: hidden;
    }
    .settingsTabSec {
      position: absolute;
      height: calc(100% - 20px) !important;
      overflow: auto;
      width: calc(100% - 270px);
      left: 250px;
      padding: 20px 0px 0px 25px;
      display: none;
    }
		.label {
			color: grey;
			font-size: 14px;
			width: 200px;
			display: inline-block;
			font-weight: bold;
		}
    .profile {
      margin: 20px; 
      min-height: 100px;
      padding: 15px;
      width: 448px;
    }
    input {
			outline: 0px;
			border-radius: 5px;
      padding: 5px;
			background-color: #2f2f2f;
			color: white;
			margin: 5px;
			border: 2px solid #232323;
			font-size: 18px;
      transition: all 0.3s;
		}
    input:focus {
			border: 2px solid #fda50f;
		}
    .editSvg {
      background-color: #2f2f2f;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      padding: 3px;
      position: absolute;
      cursor: pointer;
      left: 80px;
      top: 30px;
    }
    #loadingScreen {
      width: 100%;
      height: 100%;
      background-color: #232323;
      position: absolute;
      z-index: 100;
    }
    #loading {
      display: inline-block;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      position: absolute;
      font-size: 23px;
      font-style: italic;
      width: 128px;
      text-align: center;
    }
    #loading * {
      display: inline-block;
    }
    #loadingAnimation {
      animation-name: loading;
      animation-duration: 4s;
      animation-iteration-count: infinite;
      position: absolute;
      background-color: #ff5555;
      height: 3px;
    }
    @keyframes loading {
      0% {left: 0px; right: 100%; width: 0px;}
      25% {left: 0px; right: 0px; width: 100%;}
      50% {left: 100%; right: 0px; width: 0px;}
      75% {left: 0px; right: 0px; width: 100%;}
      100% {left: 0px; right: 100%; width: 0px;}
    }
    #loadWrap {
      width: 113px;
      transform: rotate(316deg);
      position: absolute;
      top: 67px;
      left: 10px;
    }
    #logoDiv {
      position: relative;
    }
    .switch {
			position: relative;
			display: inline-block;
			width: 50px;
			height: 24px;
		}

		.switch input {
			opacity: 0;
			width: 0;
			height: 0;
		}

		.slider {
			position: absolute;
			cursor: pointer;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background-color: #ccc;
			transition: .4s;
			border-radius: 34px;
		}

		.slider:before {
			position: absolute;
			content: "";
			height: 16px;
			width: 16px;
			left: 4px;
			bottom: 4px;
			background-color: white;
			transition: .4s;
			border-radius: 50%;
		}

		input:checked+.slider {
			background-color: #fda50f;
		}

		input:checked+.slider:before {
			transform: translateX(26px);
		}

		.labelWrap {
			position: absolute;
			right: 0px;
			top: 0px;
		}

		.smallLabel {
			position: relative;
			width: 100%;
			display: inline-block;
      margin-bottom: 10px;
		}
    .disclaimer {
      font-size: 12px;
      color: grey !important;
    }
    .button {
			color: white;
			background-color: #fda50f;
			border-radius: 5px;
			padding: 5px;
			cursor: pointer;
			display: inline-block;
      min-width: 65px;
      text-align: center;
		}
    .confirmBar .button {
      right: 10px;
      position: absolute;
      transform: translateY(-2px);
      padding: 2px;
    }
    .confirmBar {
      position: absolute;
      width: 480px;
      background-color: #232323;
      padding: 10px;
      border-radius: 10px;
      bottom: -42px;
      transition: bottom 0.5s, left 0.1s;
      left: 275px;
    }
    .settingsTabSec>.label {
      margin-bottom: 10px;
    }
    .reset {
      color: grey;
      right: 90px;
      text-decoration: underline;
      position: absolute;
      font-size: 14px;
      transform: translateY(2px);
      cursor: pointer;
    }
    .add > img {
      border-radius: 10px;
      display: block;
      margin: auto;
      padding: 5px;
      max-width: 100px;
      max-height: 100px;
    }
    .add {
      font-weight: bold;
      display: block;
      text-decoration: none;
      color: white !important;
    }
    div.add {
      cursor: default;
    }
    a.add:active {
      border: 2px solid #fda50f;
    }
    #cropBox {
      box-shadow: 0 0 0 999px rgba(47,49,54,.6);
      position: absolute;
      width: 400px;
      height: 400px;
      border-radius: 50%;
      border: 2px solid white;
      z-index: 100;
      margin: 50px;
      pointer-events: none;
    }
    #cropBoxWindow {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background-color: #2f2f2f;
      display: none;
      border-radius: 5px;
    }
    #imgCropping {
      position: absolute;
      top: 50%;
      left: 50%;
      cursor: grab;
      border-radius: 5px;
    }
    #imgContainer {
      overflow: hidden;
      width: 500px;
      height: 500px;
      position: relative;
      background-color: #191919;
    }
    #exitSettings, #exitAdminPanel {
      top: 20px;
      right: 20px;
      position: absolute;
      cursor: pointer;
      background-color: #fda50f;
      border-radius: 50%;
      padding: 5px;
      text-align: center;
      width: 21px;
      height: 21px;
      display: table;
      z-index:200;
      font-weight: bold;
    }
    #creditsList {
      margin: 18px 0px 18px 40px;
    }
    a {
      color: white !important;
    }
    #creditsList > b {
      margin-top: 15px;
      display: inline-block;
    }
    #settingsBarName {
      display: inline-block;
      margin: 5px;
      margin-left: 10px;
    }
    #serverBar {
      position: absolute;
      top: 0px;
      left: 0px;
      height: calc(100% - 10px);
      width: 70px;
      background-color: #141414;
      z-index: 15;
      padding: 5px 0px;
    }
    .serverIcon {
      border-radius: 50%;
      height: 50px;
      width: 50px;
      margin: 5px 10px 0px 10px;
      background-color: #232323;
      cursor: pointer;
      border: 0px solid black;
      transition: all 0.3s;
      display: inline-block;
    }
    .serverIcon:hover, .serverIconSelected {
      border: 2px solid #fda50f;
      margin: 3px 8px -2px 8px;
    }
    #addServer {
      position: relative;
    }
    #addServer > span {
      font-size: 30px;
      text-align: center;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    #addServerWindow, #linkOptions {
      z-index: 20;
      width: 540px;
      height: 350px;
      position: absolute;
      background-color: #232323;
      border-radius: 10px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      padding: 20px;
      display: none;
      overflow: hidden;
    }
    .heading {
      font-weight: bold;
      font-size: 25px;
      margin-bottom: 15px;
      text-align: center;
    }
    .joinServerBtn {
      width: 220px;
      background-color: #fda50f;
      border-radius: 10px;
      display: inline-block;
      padding: 5px;
      margin-top: 5px;
    }
    .joinServerWrap {
      width: 230px; 
      display: inline-block;
      background-color: #191919;
      padding: 5px;
      border-radius: 10px;
      border: 2px solid #191919;
      transition: all 0.3s;
      cursor: pointer;
    }
    .joinServerWrap:hover {
      border: 2px solid #fda50f;
    }
    .joinServerWrap > .wrap {
      position: relative;
      height: 200px;
      width: 230px;
      display: inline-block;
    }
    .joinServerWrap > .wrap > .center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 70px;
    }
    .joinServerWrap > .heading {
      font-size: 19px;
      font-weight: 400;
      width: 230px;
    }
    #addServerBlackout, #linkSettingsBlackout {
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 19;
      display: none;
    }
    #selectAction {
      left: 0;
    }
    #selectAction, #joinLinkEnter, #createServer {
      width: 100%;
      height: calc(100% - 20px);
      position: absolute;
      transition: all 0.5s;
    }
    #joinLinkEnter, #createServer {
      left: 100%;
    }
    .center {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      position: absolute;
    }
    .backBtn {
      position: absolute;
      left: 30px;
      cursor: pointer;
    }
    #serverActions {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
    }
    #actionsList {
      display: none;
      background-color: #191919;
      border-radius: 10px;
      font-size: 14px;
      position: absolute;
      right: 10px;
      width: 200px;
    }
    .serverAction {
      background-color: #232323;
      margin: 10px;
      padding: 5px;
      border: 2px solid #232323;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .serverAction:hover {
      border: 2px solid #fda50f;
    }
    #joinLinkError {
      display: none;
      color: red;
    }
    #home {
      position: absolute;
      left: 320px;
      height: 100%;
      right: 0;
    }
    #welcome {
      text-align: center;
      font-weight: 700;
      font-size: 30px;
      margin-bottom: 10px;
    }
    #home > .center {
      width: 520px;
    }
    select {
      background-color: #2f2f2f;
      color: white;
      border: 0px solid black;
      border-radius: 5px;
      padding: 5px;
      outline: 0px !important;
      cursor: pointer;
    }
    option {
      cursor: pointer !important;
    }
    option:hover {
      background-color: #fda50f;
    }
    #linkOptionsSlide > *, #linkOptions {
      margin-left: 0px;
      margin-bottom: 10px;
    }
    #numbOfUses, #linkOptionsSlide > .label {
      width: 530px;
      display: block;
    }
    #linkOptionsSlide {
      right: 13px;
      transition: all 0.5s;
      position: absolute;
    }
    #linkOptions {
      height: initial;
      text-align: left;
      height: 242px;
    }
    #linkExpires, #numbOfUses {
      margin-top: 0px;
      width: 402px;
      margin-left: 35px;
    }
    #numbOfUses {
      width: 493px;
    }
    #linkOptionsSlide > input, #linkOptionsSlide > select{
      font-size: 18px;
    }
    #linkOptionsSlide >.wrap {
      text-align: center;
    }
  .container {
    position: relative;
    cursor: pointer;
    display: inline;
  }
  /* Hide the browser's default checkbox */
  .container input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
  }
  /* Create a custom checkbox */
  .checkmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 26px;
    width: 26px;
    background-color: #2f2f2f;
    border: 2px solid #2f2f2f;
    border-radius: 5px;
    transition: all 0.4s;
  }
  .container:hover input ~ .checkmark {
    border: 2px solid #fda50f;
  }
  .container input:checked ~ .checkmark {
    background-color: #fda50f;
    border: 2px solid #fda50f;
  }
  .checkmark:after {
    content: "";
    position: absolute;
    display: none;
  }
  .container input:checked ~ .checkmark:after {
    display: block;
  }
  .container .checkmark:after {
    left: 9px;
    top: 6px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 3px 3px 0;
    transform: rotate(45deg);
  }
  input[disabled] {
    cursor: not-allowed;
  }
  #linkCodeSlide {
    width: 100%;
    height: 100%;
    position: absolute;
    left: 100%;
    transition: left 0.5s;
  }
  input[type=number] {
		width: 60px;
	}

  #mute {
    top: 50%;
    transform: translateY(-50%);
    text-align: center;
  }

  .tab {
    position: absolute;
    display: none;
    left: 250px;
    right: 0px;
  }

  #ranksList {
		height: calc(100% - 40px);
		width: 200px;
	}

  .adminLabel {
    color: grey;
    font-size: 14px;
    width: 200px;
    display: inline-block;
    font-weight: bold;
    margin-left: 13px;
    margin-top: 10px;
  }

  #ranksLabel {
    position: relative;
    cursor: pointer;
  }

  #ranksLabel>span {
    position: absolute;
    right: 25px;
    top: -3px;
    font-size: 18px;
  }

  #ranksLabel:hover {
    color: #888888;
  }
  
  .rank, .otherAction {
    border-radius: 10px;
    background-color: #2f2f2f;
    border: 2px solid #2f2f2f;
    margin: 10px;
    padding: 3px;
    text-align: center;
    cursor: pointer;
    height: 21px;
    overflow: hidden;
    transition: all 0.3s;
  }

  #rankSettings {
    height: 100%;
    display: inline-block;
    position: absolute;
    top: 0px;
    right: 30%;
    left: 250px;
    padding-right: 10px;
    overflow-y: auto;
    overflow-x: hidden;
  }

  #ranks {
    height: 100%;
  }

  #rankSettings>input {
    margin-top: 10px;
    width: calc(100% - 13px) !important;
    text-align: left;
    width: 100%;
  }

  #rankSettings>.label {
    margin-left: 0px;
    width: 100%;
  }

  #saveButton {
    position: absolute;
    bottom: 10px;
    right: 10px;
  }

  #members {
    right: 30%;
  }

  #adminUserList>div {
    width: 100%;
    border-radius: 10px;
    background-color: #2f2f2f;
    border: 2px solid #2f2f2f;
    margin: 10px;
    padding: 5px;
    text-align: left;
    height: 50px;
    overflow: hidden;
    position: relative;
  }

  #adminUserList>div>span {
    position: absolute;
    left: 195px;
    display: inline-block;
    color: grey;
    font-weight: bold;
    cursor: pointer;
    top: 50%;
    transform: translateY(-50%);
    border: 1px solid grey;
    border-radius: 50%;
    width: 21px;
    height: 21px;
    text-align: center;
  }
  #adminUserList > div > img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    vertical-align: middle;
    margin-right: 10px;
  }

  .moreActions {
    position: absolute;
    right: 0px;
    top: 50%;
    transform: translateY(-50%);
    width: 21px !important;
    height: 21px !important;
    padding: 6px;
    background-color: #232323;
    cursor: pointer;
  }

  #promoteMenu, #moreActionsMenu {
    width: 250px;
    height: 340px;
    display: none;
    background-color: #232323;
    border-radius: 10px;
    position: absolute;
    left: 200px;
    z-index: 30;
    overflow: auto;
  }

  #moreActionsMenu {
    left: 530px;
  }

  #bodyClick {
    z-index: 29;
    width: 100%;
    height: 100%;
    position: absolute;
    left: 0px;
    top: 0px;
    pointer-events: none;
  }

  .rankTags {
    left: 220px;
    position: absolute;
    display: inline-block;
    overflow: auto;
    top: 50%;
    transform: translateY(-50%);
    width: 350px;
  }

  .rank:hover, .otherAction:hover {
    border: 2px solid #fda50f;
  }

  .rankTag {
    display: inline-block;
    margin: 2.5px 0px 2.5px 10px;
    background-color: #232323;
    border-radius: 5px;
    padding: 3px 5px;
    font-size: 13px;
  }

  .x {
    display: inline-block;
    cursor: pointer;
    font-weight: bold;
    color: grey;
    margin-left: 10px;
  }

  #muteBox, #banBox {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 500px;
    text-align: center;
    padding: 30px;
    border-radius: 10px;
    background-color: #232323;
    z-index: 500;
  }

  #muteBox input, #banBox input {
    text-align: center;
  }

  #reason, #banReason {
    width: calc(100% -  144px);
  }

  /* remove arrows */
  input::-webkit-outer-spin-button,
  input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  #adminPanelFrame {
    position: absolute;
    top: 0px;
    left: 0px;
    width: 100%;
    height: 100%;
    z-index: 300;
    background-color: #3c3c3c;
    display: none;
  }

  #adminPanelFrame .label, #adminPanelFrame .smallLabel {
    margin-top: 10px;
    margin-bottom: 0px;
  }
	</style>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="Description" content="Unnamed Chat, the superior chat website" />
	<script src="/socket.io/socket.io.js">
	</script>
  <link rel="icon" href="/assets/logo.png" type="image/x-icon"/>
</head>

<body>
  <section id="loadingScreen">
    <div id="loading">
    <div id="logoDiv">
      <div id="loadWrap">
        <div id="loadingAnimation"></div>
      </div>
      <img src="/assets/logoNoLine.png" alt="Unnamed Chat logo" />
      <span>Loading</span>
    </div>
    </div>
  </section>
  <div id="home">
    <div class="center">
      <div id="welcome"></div>
      <div id="notice">I have coded a new maths game. If you are here for my maths game, <a href="/maths">click here</a></div>
    </div>
  </div>
  <div id="addServerBlackout" onclick="closeJoinServer()"></div>
  <div id="linkSettingsBlackout" onclick="closeGetLink()"></div>
  <div id="serverBar">
    <img src='/assets/logo.png' class='serverIcon' id='homeIcon' alt='server icon' onclick='showHome(this)' />
    <div id="mainServers"></div>
    <div class='serverIcon' id='addServer' onclick='addServer()'><span>+</span></div>
  </div>
  <div id="linkOptions">
    <div id="linkOptionsSlide">
      <img class="backBtn" src="/assets/back.png" alt="back" onclick="closeGetLink()" style="left:0px" />
      <div class="heading">Link Settings</div>
      <div class="label">EXPIRES AFTER</div>
      <div>
        <div style="position: relative; top: 3px;">
          <label class="container">
            <input checked type="checkbox" onclick="if (this.checked) {document.getElementById('linkExpires').value = ''; document.getElementById('linkExpires').type = 'number'; document.getElementById('linkExpires').removeAttribute('disabled')} else {document.getElementById('linkExpires').type = ''; document.getElementById('linkExpires').value = 'Never'; document.getElementById('linkExpires').disabled = true}"/>
            <span class="checkmark"></span>
          </label>
        </div> 
        <input type="number" min="1" max="1000" id="linkExpires" />
        <select id="unitOfTime">
          <option value="m">Minutes</option>
          <option value="h">Hours</option>
          <option value="d">Days</option>
          <option value="y">Years</option>
        </select>
      </div>
      <div class="label">MAX NUMBER OF USES</div>
      <div>
        <div style="position: relative; top: 3px;">
          <label class="container">
            <input checked type="checkbox" onclick="if (this.checked) {document.getElementById('numbOfUses').value = ''; document.getElementById('numbOfUses').type = 'number'; document.getElementById('numbOfUses').removeAttribute('disabled')} else {document.getElementById('numbOfUses').type = ''; document.getElementById('numbOfUses').value = 'None'; document.getElementById('numbOfUses').disabled = true}"/>
            <span class="checkmark"></span>
          </label>
        </div>
        <input type="number" min="1" max="1000" id="numbOfUses" />
      </div>
      <div class="wrap">
        <span onclick="getLink()" class="button" style="margin-top: 10px;">Get Link</span>
      </div>
    </div>
    <div id="linkCodeSlide">
      <img class="backBtn" src="/assets/back.png" alt="back" onclick="toLinkOptions()" />
      <div class="heading">Invite People</div>
      <div class="center" style="width: 100%; text-align: center;">
        <div>
          <input id="linkInputRead" readonly style="width:400px; text-align:center;" />
          <span class="button" onclick='navigator.clipboard.writeText(lastKey).then(function(){document.getElementById("copyResponse").innerText="Copied!"}, function(){document.getElementById("copyResponse").innerText="Your browser does not support the clipboard"});'>Copy</span>
        </div>
        <div id="copyResponse"></div>
      </div>
    </div>
  </div>
  <div class="sidebar" id="mainSidebar">
		<div class="sideTitle" id="serverName">Unnamed Chat</div><div id="serverActions" onclick="showServerActions()">V</div>
    <div id="actionsList">
      <div class="serverAction" onclick="document.getElementById('adminPanelFrame').style.display = 'block'; updateAdmin()">Server settings</div>
      <div class="serverAction" onclick="document.getElementById('linkOptions').style.display = 'block'; document.getElementById('linkSettingsBlackout').style.display = 'block';">Get invite link</div>
      <div class="serverAction" onclick="socket.emit('leaverServer', getCookie('name'), getCookie('pass'),socket.id, serverId)">Leave Server</div>
    </div>
    <div id="channels">
      <div class="channelLabel" style="border: 2px solid #fda50f;" onclick="openChannel(0)">Text</div>
      <div class="channelLabel" onclick="openChannel(1)">Voice</div>
    </div>
    <a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/channel/UC_NkjQkGZjmU9-5F9mLZ8iQ/" class="add">
    Sub to Sleb
      <img
      src="https://yt3.ggpht.com/a/AATXAJwGn2riIWZ0HfSUS7i1NJOEshECUucZXSvpCA=s288-c-k-c0xffffffff-no-rj-mo" alt="add" />
      <div class="disclaimer">Advertisement</div>
    </a>
    <div id="userOptions">
      <img class="userListImg" src="/assets/logo.png" alt="your profile pic" id="sideOwnPic"/>
      <span id="settingsBarName"></span>
      <img id="userSettingsBtn" src="/assets/gear.png"/>
    </div>
	</div>
	<div id="messages" role="main"></div>
  <div id="userList"></div>
	<input id="msgBox" autocomplete="off" aria-label="Type your message here" autofocus/>
  <div id="userSettings">
    <div id="exitSettings" onclick="closeSettings()">&times;</div>
    <div class="sidebar">
      <div class="sideTitle">User Settings</div>
      <div class="settingsTab" onclick="showSettingsTab(0)" style="border: 2px solid #fda50f;">Account</div>
      <div class="settingsTab" onclick="showSettingsTab(1)">Email Preferences</div>
      <div class="settingsTab" onclick="showSettingsTab(2)">Credits</div>
    </div>
    <section class="settingsTabSec" style="padding: 0px">
      <div class="msgBox profile">
        <input type="file" id="fileUpload" onchange="updateAv(this)" style="display: none" />
        <img alt="your profile picture" src="/assets/logo.png" style="cursor: pointer" id="settingsPic" onclick="changeImg()"/>
        <svg viewBox="0 0 96 96" class="editSvg" onclick="changeImg()">
          <path style="fill: white;" d="M20.5,64v11.5H32l33.8-33.8L54.3,30.2L20.5,64z M74.6,32.9c1.2-1.2,1.2-3.1,0-4.3l-7.1-7.1   c-1.2-1.2-3.1-1.2-4.3,0L57.6,27L69,38.4L74.6,32.9z" />
        </svg>
        <span class="label">USERNAME</span>
        <input id="name" disabled />
      </div>
      <div id="cropBoxWindow">
        <div class="sideTitle" style="text-align: center">Crop</div>
        <div id="imgContainer">
          <div id="cropBox">
          </div>
          <img id="imgCropping" draggable="false" src="" />
        </div>
        <div class="button" style="position: relative; right: 0; margin: 10px;" onclick="finishAvCrop()">Save</div>
      </div>
    </section>
    <section class="settingsTabSec" style="width: 500px">
      <div class="label">EMAIL PREFERENCES</div>
      <span class="smallLabel">Security Emails
        <div class="labelWrap">
          <label class="switch">
            <input type="checkbox" checked disabled>
            <span class="slider" style="cursor:not-allowed"></span>
          </label>
        </div>
      </span>
      <span class="smallLabel">News Emails
        <div class="labelWrap">
          <label class="switch">
            <input type="checkbox" id="getNews" onclick="changeMailList()">
            <span class="slider"></span>
          </label>
        </div>
      </span>
      <span class="smallLabel">Marketing Emails
        <div class="labelWrap">
          <label class="switch">
            <input type="checkbox" id="getMarketing" onclick="changeMailList()">
            <span class="slider"></span>
          </label>
        </div>
      </span>
      <div class="disclaimer">
        You cannot unsubscribe from security emails
      </div>
    </section>
    <div class="confirmBar" id="confirmMailLists">
        Save email preferences <span class="reset" onclick="setMail(); changeMailList()">reset</span>
        <span class="button" onclick="saveMailLists()">save</span>
    </div>
    <section class="settingsTabSec">
      Unnamed Chat would like to acknowledge the following parties for their contribution.<br/>
      <div id="creditsList">
        <b>Libraries and Packages</b><br/>
        <a rel="noopener noreferrer" href="https://expressjs.com/">Express</a><br/>
        <a href="https://socket.io/" rel="noopener noreferrer">Socket.io</a><br/>
        <a href="https://nodemailer.com/" rel="noopener noreferrer">Nodemailer</a><br/>
        <b>Images</b><br/>
        <a href="https://www.flaticon.com/authors/freepik" rel="noopener noreferrer">Freepik</a><br/>
        <a href="https://www.flaticon.com/" rel="noopener noreferrer">Flaticon</a><br/>
        <b>Database</b><br/>
        <a href="https://www.mongodb.com/" rel="noopener noreferrer">Mongodb</a><br/>
        <b>Hosting</b><br/>
        <a href="https://repl.it/" rel="noopener noreferrer">Repl</a><br/>
      </div>
    </section>
  </div>
  <div id="addServerWindow">
    <section id="selectAction">
    <img class="backBtn" src="/assets/back.png" alt="back" onclick="closeJoinServer()" />
      <div class="heading">Add a Server</div>
      <div class="joinServerWrap" style="margin-right: 25px" onclick="document.getElementById('selectAction').style.left='-100%'; document.getElementById('joinLinkEnter').style.left='0';">
        <div class="heading">Join a Server</div>
        <div class="wrap">
          <img class="center" alt="Join" src="/assets/share.png" style="width:43px; height:43px" />
        </div>
        <div class="joinServerBtn">Join</div>
      </div>
      <div class="joinServerWrap" onclick="document.getElementById('selectAction').style.left='-100%'; document.getElementById('createServer').style.left='0';">
        <div class="heading">Create a Server</div>
        <div class="wrap">
          <b class="center">+</b>
        </div>
        <div class="joinServerBtn">Create</div>
      </div>
    </section>
    <section id="joinLinkEnter">
      <img class="backBtn" src="/assets/back.png" alt="back" onclick="document.getElementById('selectAction').style.left='0'; document.getElementById('joinLinkEnter').style.left='100%';" />
      <div class="heading">Join a Server</div>
      <div class="center">
        <b style="display: inline-block; margin-bottom: 10px">Enter an invite link</b>
        <div style="margin-bottom: 10px">
          <div id="joinLinkError">This invite link is invalid</div>
          <span>unnamedchat.repl.co/invite/</span><input id="joinLinkIn" />
        </div>
      </div>
      <span class="button" style="position: absolute; bottom: 30px; transform: translateX(-50%)" onclick="confirmJoin()">Join</span>
    </section>
    <section id="createServer">
      <img class="backBtn" src="/assets/back.png" alt="back" onclick="serverCreateSlideBack()"" />
      <div class="heading">Create a Server</div>
      <div class="center">
        <input type="file" id="fileUploadServerNew" style="display: none" onchange="newServerImg(this)" />
        <div style="width: 100px; height: 100px; display: inline-block; position: relative;" onclick="document.getElementById('fileUploadServerNew').click();">
          <span style="font-size: 28px; background-color: #2f2f2f; font-weight: bold; position: relative; cursor:pointer; width: 100px; height: 100px;" id="newInitialsWrap" class="imgRound">
            <span class="center" id="newServerInitials"></span>
          </span>
          <img class="imgRound" id="newServerImgPreview" src="" alt="server picture preview" style="display:none; cursor:pointer; width: 100px; height: 100px;" />
          <svg viewBox="0 0 96 96" class="editSvg" onclick="" style="left: auto; top:0px; right:0px; background-color: #fda50f">
            <path style="fill: white;" d="M20.5,64v11.5H32l33.8-33.8L54.3,30.2L20.5,64z M74.6,32.9c1.2-1.2,1.2-3.1,0-4.3l-7.1-7.1   c-1.2-1.2-3.1-1.2-4.3,0L57.6,27L69,38.4L74.6,32.9z" />
          </svg>
        </div>
        <div style="color: grey; font-size:14px; font-weight: bold; margin-top: 15px">SERVER NAME</div>
        <input id='newServerName' oninput="setInitials(this)" />
      </div>
      <span class="button" style="position: absolute; bottom: 30px; transform: translateX(-50%)" onclick="sendCreateServer()">Create</span>
    </section>
  </div>
  <!-- ADMIN PANEL -->
  <div id="adminPanelFrame">
    <div id="exitAdminPanel" onclick="if (awaitingSave) {shakeRanksSaveBar(); return;} document.getElementById('adminPanelFrame').style.display='none';">&times;</div>
    <div id="bodyClick" onclick="this.style.pointerEvents='none'; document.getElementById(hideElement).style.display = 'none'"></div>
    <div class="sidebar">
      <div class="sideTitle">Admin Panel</div>
      <div class="tabLabel" onclick="showTab(0)">Ranks</div>
      <div class="tabLabel" onclick="showTab(1)">Members</div>
    </div>
    <!--permissions-->
    <section id="ranks" class="tab">
      <div class="adminLabel" id="ranksLabel">RANKS
        <span>+</span>
      </div>
      <div id="ranksList">
      </div>
      
      <div id="rankSettings">

        <div class="label" style="margin-top: 10px">DISPLAY</div>
        <input id="rankName" style="margin-left: 0px" />

        <span class="smallLabel">Colour
          <div class="labelWrap">
            <input type="color" id="rankColor" onchange="showConfirmBar()" />
          </div>
        </span>

        <div class="label">GENERAL</div>
        <span class="smallLabel">Can Edit Ranks
        <div class="labelWrap">
          <label class="switch">
            <input type="checkbox" id="rankCanEditRanks" onchange="showConfirmBar()">
            <span class="slider"></span>
          </label>
        </div>
        </span>

        <div class="label">MODERATION</div>
        <span class="smallLabel">Can Mute
        <div class="labelWrap">
          <label class="switch">
            <input type="checkbox" id="rankCanMute" onchange="showConfirmBar()">
            <span class="slider"></span>
          </label>
        </div>
        </span>
        <span class="smallLabel">Can Ban
        <div class="labelWrap">
          <label class="switch">
            <input type="checkbox" id="rankCanBan" onchange="showConfirmBar()">
            <span class="slider"></span>
          </label>
        </div>
        </span>

        <div class="confirmBar" id="confirmRankChange" style="left: 516px; position: fixed;">
        Save rank changes 
          <span class="reset" onclick="awaitingSave = false;  document.getElementById('confirmRankChange').style.bottom = '-42px'; showRank(shownRank[0], shownRank[1])">reset</span>
        <span class="button" onclick="saveRankChanges()">save</span>
        </div>
      </div>
    </section>
    <!-- user list + actions -->
    <section id="members" class="tab">
      <span class='adminLabel'>USER LIST</span>
      <div id="adminUserList">
      </div>
      <div id="promoteMenu"></div>
      <div id="moreActionsMenu">
        <div class="otherAction" onclick="showMuteBox()">Mute</div>
        <div class="otherAction" onclick="alert('no')">Kick</div>
        <div class="otherAction" onclick="showBanBox()">Ban</div>
      </div>
    </section>
    <div id="muteBox">
      <div class="heading" id="muting">Muting</div>
      <div><input id="reason" placeholder="reason"></div>
      <input type="number" id="years" placeholder="y">
      <input type="number" id="days" placeholder="d">
      <input type="number" id="hours" placeholder="h">
      <input type="number" id="minutes" placeholder="m">
      <div class="button" onclick="mute()">Mute</div>
    </div>
    <div id="banBox">
      <div class="heading" id="banning">Banning</div>
      <div><input id="banReason" placeholder="reason"></div>
      <input type="number" id="banYears" placeholder="y">
      <input type="number" id="banDays" placeholder="d">
      <input type="number" id="banHours" placeholder="h">
      <input type="number" id="banMinutes" placeholder="m">
      <div class="button" onclick="ban()">Ban</div>
    </div>
  </div>
  <audio id="callAudio" autoplay></audio>
  <script>
    if (location.protocol !== "https:") {
      location.protocol = "https:";
    }
    var socket = io();
    showSettingsTab(0);
    var newServerImgB64 = null;
    //url req
    var urlParams = {};
    var match
    var pl = /\+/g
    var search = /([^&=]+)=?([^&]*)/g
    var decode = function (s) {return decodeURIComponent(s.replace(pl, " "));}
    var query  = window.location.search.substring(1);
    while (match = search.exec(query))
    urlParams[decode(match[1])] = decode(match[2]);
    if (urlParams.unsubscribe) {
      document.getElementById("userSettings").style.display = "inline-block";
      document.getElementById("name").value = getCookie("name");
      showSettingsTab(1);
    }
    function serverCreateSlideBack() {
      document.getElementById('selectAction').style.left='0'; 
      document.getElementById('createServer').style.left='100%';
    }
    function sendCreateServer() {
      socket.emit('createServer', getCookie('name'), getCookie('pass'), socket.id, document.getElementById('newServerName').value, newServerImgB64);
      newServerImgB64 = null; 
      serverCreateSlideBack(); 
      closeJoinServer();
      document.getElementById('newServerName').value = ''; 
      document.getElementById('newServerInitials').innerText = '';
    }
    socket.on("serverCreated", function(name, id, ranks, msgLog, users) {
      servers[id] = {
        name: name,
        id: id,
        ranks: ranks,
        msgLog: msgLog
      }
      userList[id] = users;
      document.getElementById('mainServers').innerHTML += "<img src='/assets/server/" + id + ".png' class='serverIcon' alt='server icon' onclick='showServer(" + id + ", this)' onerror='serverImageLoadErr(" + id + ",\"" + name + "\", this)' />";
    });
    //sounds
    var noteSound = new Audio();
    //noteSound.src = "https://freesound.org/people/YourFriendJesse/sounds/235911/download/235911__yourfriendjesse__notification-sound.wav";
    noteSound.src = "/assets/ping.mp3";
    //ui
    var shownChannel = 0;
    var dataUrl;
    var audio;
    var awaitingSave;
    document.getElementById("userSettingsBtn").onclick = function() {
      document.getElementById("userSettings").style.display = "inline-block";
    }
    function closeSettings() {
      if (awaitingSave) {
        shakeSaveBar();
        return;
      }
      document.getElementById("userSettings").style.display = "none";
    }
    function setInitials(elm) {
      document.getElementById('newServerInitials').innerText = genInitials(elm.value.toUpperCase());
    }
    function genInitials(value) {
      value = value.toUpperCase();
      if (value[0] === " ") value = value.slice(1, 99);
      let split = value.split(' ');
      if (!split[0]) {
        return "";
      } else if (!split[1]) {
        return split[0][0];
      } else {
        return split[0][0] + split[1][0];
      }
    }
    function confirmJoin() {
      socket.emit('confirmJoin', getCookie('name'), getCookie('pass'), socket.id, document.getElementById('joinLinkIn').value); 
    }
    function toLinkOptions() {
      document.getElementById("linkOptionsSlide").style.right = "0px"
      document.getElementById("linkCodeSlide").style.left = "100%";
    }
    function closeGetLink() {
      document.getElementById("linkOptionsSlide").style.right = "13px"
      document.getElementById("linkCodeSlide").style.left = "100%";
      document.getElementById('linkOptions').style.display = 'none'; document.getElementById('linkSettingsBlackout').style.display = 'none';
    }
    function showConfirmBar() {
      if (
        document.getElementById("rankName").value === ranksList[shownRank[0]].name &&
        document.getElementById("rankCanMute").checked === ranksList[shownRank[0]].canMute &&
        document.getElementById("rankCanEditRanks").checked === ranksList[shownRank[0]].canEditRanks &&
        document.getElementById("rankColor").value === ranksList[shownRank[0]].color &&
        document.getElementById("rankCanBan").checked === ranksList[shownRank[0]].canBan
      ) {
        document.getElementById("confirmRankChange").style.bottom = "-42px";
        awaitingSave = false;
      } else {
        document.getElementById("confirmRankChange").style.bottom = "20px";
        awaitingSave = document.getElementById("confirmRankChange");
      }
    }
    function getLink() {
      document.getElementById("linkExpires").style.borderColor = "#232323";
      document.getElementById("numbOfUses").style.borderColor = "#232323";
      if (document.getElementById("linkExpires").value === "" || document.getElementById("linkExpires").value < 1) {
        document.getElementById("linkExpires").style.borderColor = "red";
        return;
      }
      if (document.getElementById("numbOfUses").value === "" || document.getElementById("numbOfUses").value < 1) {
        document.getElementById("numbOfUses").style.borderColor = "red";
        return;
      }
      let units = {
        m: 60000,
        h: 3600000,
        d: 86400000,
        y: 31536000000
      }
      let expires;
      let maxUses = parseInt(document.getElementById("numbOfUses").value);
      if (document.getElementById("linkExpires").value === "Never") {
        expires = 8640000000000000;
      } else {
        expires = new Date().getTime() + document.getElementById("linkExpires").value * units[document.getElementById("unitOfTime").value];
      }
      if (document.getElementById("numbOfUses").value === "None") {
        //cant send real Infinity in socket.io
        maxUses = "Infinity";
      }
      socket.emit('getInviteLink', getCookie('name'), getCookie('pass'), socket.id, serverId, expires, maxUses);
    }
    function shakeSaveBar() {
      awaitingSave.style.left = "265px";
      setTimeout(function(){awaitingSave.style.left = "285px";}, 100);
      setTimeout(function(){awaitingSave.style.left = "265px";}, 200);
      setTimeout(function(){awaitingSave.style.left = "285px";}, 300);
      setTimeout(function(){awaitingSave.style.left = "265px";}, 400);
      setTimeout(function(){awaitingSave.style.left = "285px";}, 500);
      setTimeout(function(){awaitingSave.style.left = "275px";}, 600);
    }
    function shakeRanksSaveBar() {
      awaitingSave.style.left = "516px";
      setTimeout(function(){awaitingSave.style.left = "526px";}, 100);
      setTimeout(function(){awaitingSave.style.left = "506px";}, 200);
      setTimeout(function(){awaitingSave.style.left = "526px";}, 300);
      setTimeout(function(){awaitingSave.style.left = "506px";}, 400);
      setTimeout(function(){awaitingSave.style.left = "526px";}, 500);
      setTimeout(function(){awaitingSave.style.left = "516";}, 600);
    }
    function showSettingsTab(tab) {
      if (awaitingSave) {
        shakeSaveBar();
        return;
      }
      for (i = 0; i<document.getElementsByClassName("settingsTab").length; i++) {
        document.getElementsByClassName("settingsTab")[i].style.border = "2px solid #2f2f2f";
        document.getElementsByClassName("settingsTabSec")[i].style.display = "none";
      }
      document.getElementsByClassName("settingsTab")[tab].style.border = "2px solid #fda50f";
      document.getElementsByClassName("settingsTabSec")[tab].style.display = "inline-block";
    }
    function saveMailLists() {
      mailLists[0] = document.getElementById("getNews").checked;
      mailLists[1] = document.getElementById("getMarketing").checked;
      changeMailList();
      socket.emit("updateMailLists", getCookie("name"), getCookie("pass"), socket.id, mailLists[0], mailLists[1]);
    }
    pc = new RTCPeerConnection();
    pc.ontrack = function(stream) {
      console.log(stream);
      document.getElementById("callAudio").srcObject = stream.streams[0];
    };
    async function openChannel(channel) {
      document.getElementsByClassName("channelLabel")[shownChannel].style.border = "2px solid #2f2f2f";
      shownChannel = channel;
      document.getElementsByClassName("channelLabel")[channel].style.border = "2px solid #fda50f";
      if (channel === 1) {
        const offer = await pc.createOffer();
        await pc.setLocalDescription(new RTCSessionDescription(offer));
        socket.emit("sendCallOffer", getCookie("name"), getCookie("pass"), socket.id, serverId, offer);
        navigator.getUserMedia(
          {audio: true},
          stream => {
            stream.getTracks().forEach(track => pc.addTrack(track, stream));
          },
          error => {
            console.error(error);
          }
        );
      }
    }
    socket.on("callOffer", async function(socketId, offer) {
      if (socketId === socket.id) return;
      //let pc = new RTCPeerConnection();
      await pc.setRemoteDescription(new RTCSessionDescription(offer));
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(new RTCSessionDescription(answer));
      socket.emit("sendCallAnswer", getCookie("name"), getCookie("pass"), socket.id, serverId, socketId, answer);
    });
    socket.on("callAnswer", async function(answer) {
      //let pc = new RTCPeerConnection();
      await pc.setRemoteDescription(new RTCSessionDescription(answer));
    });
    function showServer(server, elm) {
      serverId = server;
      socket.emit("showServer", getCookie("name"), getCookie("pass"), socket.id, server);
      updateAdmin();
      //pull from cache
      setServerInfo(servers[server].msgLog, servers[server].mute, servers[server].name);
      //highlight and display
      let serverIcons = Array.from(document.getElementsByClassName("serverIcon"));
      serverIcons.forEach(icon => icon.className = "serverIcon");
      elm.className = "serverIcon serverIconSelected";
      document.getElementById("serverActions").style.display = "block";
      document.getElementById("userList").style.display = "block";
      document.getElementById("msgBox").style.display = "block";
      document.getElementById("messages").style.display = "block";
      document.getElementById("home").style.display = "none";
    }
    function addServer() {
      document.getElementById("addServerWindow").style.display = "inline-block";
      document.getElementById("addServerBlackout").style.display = "block";
      document.getElementById("addServerWindow").style.display = "inline-block";
    }
    function closeJoinServer() {
      document.getElementById("addServerBlackout").style.display = "none";
      document.getElementById("addServerWindow").style.display = "none";
    }
    function showServerActions() {
      document.getElementById("actionsList").style.display = "inline-block"; 
      document.getElementById("serverActions").innerText = "^";
      document.getElementById("serverActions").onclick = null;
      window.onmouseup = function() {
        document.getElementById("actionsList").style.display = "none"; 
        document.getElementById("serverActions").innerText = "V";
        window.onmouseup = null;
        setTimeout(function() {
          document.getElementById("serverActions").onclick = showServerActions;
        }, 100);
      }
    }
    //main
    var lastSender;
    var muteEnd;
    var avatars;
    var doneConnect = false;
    var mailLists;
    var chatHTML;
    var onlineUsers =[];
    function changeMailList() {
      if (document.getElementById("getNews").checked !== mailLists[0] || document.getElementById("getMarketing").checked !== mailLists[1]) {
        awaitingSave = document.getElementById("confirmMailLists");
        document.getElementById("confirmMailLists").style.bottom = "20px";
      } else {
        awaitingSave = false;
        document.getElementById("confirmMailLists").style.bottom = "-42px";
      }
    }
    function changeImg() {
      document.getElementById("fileUpload").click();
    }
    var imgCropping = document.getElementById("imgCropping");
    var initX, initY, mousePressX, mousePressY;
    imgCropping.addEventListener("mousedown", function(event) {
      initX = this.offsetLeft;
      initY = this.offsetTop;
      mousePressX = event.clientX;
      mousePressY = event.clientY;
      window.addEventListener("mousemove", repositionElement);
      window.addEventListener("mouseup", function() {
        window.removeEventListener("mousemove", repositionElement);
      });
    });
    function repositionElement(event) {
      imgCropping.style.left = initX + event.clientX - mousePressX + "px";
      imgCropping.style.top = initY + event.clientY - mousePressY + "px";
    }
    function updateAv(elm) {
      window.newAvImgData = document.createElement("img");
      newAvImgData.onload = function() {
        document.getElementById("imgCropping").style.left = 250-(newAvImgData.width/2) + "px";
        document.getElementById("imgCropping").style.top = 250-(newAvImgData.height/2) + "px";
        document.getElementById("imgCropping").src = newAvImgData.src;
        document.getElementById("cropBoxWindow").style.display = "inline-block";
      }
      newAvImgData.src = URL.createObjectURL(elm.files[0]);
    }
    function newServerImg(elm) {
      window.imgData = document.createElement("img");
      imgData.onload = function() {
        let c = document.createElement("canvas");
        c.width = 128;
        c.height = 128;
        if (imgData.height > imgData.width) {
          c.getContext("2d").drawImage(imgData, 0, -((imgData.height/imgData.width)*128-128)/2, 128, (imgData.height/imgData.width)*128);
        } else {
          c.getContext("2d").drawImage(imgData, -((imgData.width/imgData.height)*128-128)/2, 0, (imgData.width/imgData.height)*128, 128);
        }
        let finalImgData = c.toDataURL();
        document.getElementById("newServerImgPreview").onload = function() {
          this.style.display = "inline-block";
          document.getElementById("newInitialsWrap").style.display = "none";
        }
        document.getElementById("newServerImgPreview").src = finalImgData;
        window.newServerImgB64 = finalImgData;
      }
      imgData.src = URL.createObjectURL(elm.files[0]);
    }
    function finishAvCrop() {
      document.getElementById("cropBoxWindow").style.display = "none";
      let c = document.createElement("canvas");
      c.width = 128;
      c.height = 128;
      c.getContext("2d").drawImage(newAvImgData, 50-parseInt(imgCropping.style.left), 50-parseInt(imgCropping.style.top), 400, 400, 0, 0, 128, 128);
      document.getElementById("sideOwnPic").src = c.toDataURL();
      document.getElementById("settingsPic").src = c.toDataURL();
      socket.emit("updateAvatar", c.toDataURL(), getCookie("name"), getCookie("pass"), socket.id);
    }
    function clearCookie(name) {
      document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 GMT;";
    }
    function getCookie(name) {
      var value = "; " + document.cookie;
      var parts = value.split("; " + name + "=");
      if (parts.length == 2) return parts.pop().split(";").shift();
    }
    function isMuted(time) {
      document.getElementById("msgBox").value = "";
      document.getElementById("msgBox").placeholder = "You are muted until ";
      if (new Date(time).getDate() !== new Date().getDate() || new Date(time).getMonth() !== new Date().getMonth() || new Date(time).getYear() !== new Date().getYear()) {
        document.getElementById("msgBox").placeholder += new Intl.DateTimeFormat('en-AU', {year: 'numeric', month: 'numeric', day: 'numeric'}).format(time) + " at ";
      }
      document.getElementById("msgBox").placeholder += 
      new Intl.DateTimeFormat('en-AU', {hour: 'numeric', minute: 'numeric', hour12: true}).format(time);
      document.getElementById("msgBox").disabled = "true";
      muteEnd = time;
      checkIfMuted()
    }
    function checkIfMuted() {
      if (muteEnd < new Date().getTime()) {
        document.getElementById("msgBox").removeAttribute("disabled");
        document.getElementById("msgBox").placeholder = "";
      } else {
        setTimeout(checkIfMuted, 60 - new Date().getSeconds())
      }
    }
    if (getCookie("name") && getCookie("pass")) {
      socket.on("connect", function() {
        socket.on("test", function(p1, p2, p3, p4, p5) {
          console.log("Recieved 'test' call with params: " + p1 + "-" + p2 + "-" + p3 + "-" + p4 + "-" + p5);
        });
        if (doneConnect === false) {
          console.log("emitted chatConnect: " + performance.now())
          socket.emit("chatConnect", getCookie("name"), getCookie("pass"), socket.id);
          window.onbeforeunload = function(e) {
            socket.emit("disconnectInfo", getCookie("name"), getCookie("pass"));
          }
          doneConnect = true;
        }
      });
      document.getElementById("msgBox").addEventListener("keydown", function(key) {
        if (key.key === "Enter" && document.getElementById("msgBox").value && document.getElementById("msgBox").value.length < 500) {
          socket.emit("msg", document.getElementById("msgBox").value, getCookie("name"), getCookie("pass"), socket.id, new Date().getTime(), serverId);
          document.getElementById("msgBox").value = "";
        }
      });
      socket.on("msg", function(name, msg, time) {
        if (msg.search("@" + getCookie("name")) > -1) {
          noteSound.currentTime = 0
          noteSound.play();
        }
        servers[serverId].msgLog.push(["msg", name, msg, time]);
        chatHTML = "";
        addMsg(name, msg, time);
        document.getElementById("messages").innerHTML += chatHTML;
        document.getElementById("messages").scrollTop = 9999999999;
      });
    } else {
      clearCookie("name");
      clearCookie("pass");
      window.location.href = "/";
    }
    socket.on("accountSyncError", function() {
      clearCookie("name");
      clearCookie("pass");
      window.location.href = "/";
    });
    socket.on("muteMsg", function(user, auth, duration, reason, finish) {
      chatHTML = "";
      generateMuteBox(user, auth, duration, reason);
      document.getElementById("messages").innerHTML += chatHTML;
      document.getElementById("messages").scrollTop = 9999999999;
      if (getCookie("name") === user) {
        isMuted(finish);
      }
    });
    socket.on("banMsg", function(user, auth, duration, reason) {
      chatHTML = "";
      generateBanBox(user, auth, duration, reason);
      document.getElementById("messages").innerHTML += chatHTML;
      document.getElementById("messages").scrollTop = 9999999999;
      if (getCookie("name") === user) {
        location.reload();
      }
    });
    socket.on("warnMsg", function(user, auth, duration, reason) {
      chatHTML = "";
      generateWarnBox(user, auth, duration, reason);
      document.getElementById("messages").innerHTML += chatHTML;
      document.getElementById("messages").scrollTop = 9999999999;
    });
    var serverId;
    function setMail() {
      if (mailLists[0]) document.getElementById("getMarketing").checked = true;
      if (mailLists[1]) document.getElementById("getNews").checked = true;
    }
    function serverImageLoadErr(id, name, elm) {
      if (!elm.parentElement) return;
      elm.outerHTML = `
      <span class='serverIcon' style='position: relative; font-weight: bold;' onclick='showServer(` + id + `, this)'>
        <span class='center'>`
          + genInitials(name) +
          `
        </span>
      </span>`
    }
    socket.on("firstConnect", function(onlineUserList, verify, mailPrefs, userList, servers, premium) {
      console.log("first connect start: " + performance.now());
      //globalise users and server
      //todo: fix when user join server userList will be missing for that server
      window.userList = userList;
      window.servers = servers;
      //online user list
      onlineUsers = onlineUserList;
      for (i=0; i<onlineUserList.length; i++) { 
        document.getElementById("userList").innerHTML += "<div><img class='userListImg' src='/assets/user/" + onlineUserList[i] + ".png' alt='" + onlineUserList[i] + "s profile picture' /><span>" + onlineUserList[i] + "</span></div>"
      }
      if (premium) {
        let adds = document.getElementsByClassName("add");
        for (i=0; i<adds.length; i++) {
          adds[i].style.display = "none";
        }
      }
      //verified
      if (!verify) {
        document.getElementById("msgBox").disabled = true;
        document.getElementById("msgBox").placeholder = "Verify your email to post messages";
      }
      //own images
      document.getElementById("sideOwnPic").src = "/assets/user/" + getCookie("name") + ".png";
      document.getElementById("settingsPic").src = "/assets/user/" + getCookie("name") + ".png"
      document.getElementById("name").value = getCookie("name");
      //servers
      let barHTML = "";
      if (servers && servers.length !== 0) {
        for (info in servers) {
          barHTML += "<img src='/assets/server/" + servers[info].id + ".png' class='serverIcon' alt='server icon' onclick='showServer(" + servers[info].id + ", this)' onerror='serverImageLoadErr(" + servers[info].id + ",\"" + servers[info].name + "\", this)' />";
        }
      }
      document.getElementById("mainServers").innerHTML = barHTML;
      showHome(document.getElementById('homeIcon'));
      //other
      document.getElementById("settingsBarName").innerText = getCookie("name");
      document.getElementById("welcome").innerText = "Welcome back, " + getCookie("name");
      //email prefs
      mailLists = mailPrefs;
      setMail();
      //finish
      document.getElementById("messages").scrollTop = 9999999999;
      document.getElementById("loadingScreen").style.display = "none";
      console.log("finished first connect: " + performance.now());
    });
    function generateMuteBox(user, auth, duration, reason) {
      lastSender = "<SERVER>";
      chatHTML += "<div class='msgBox'><span class='title'>Mute</span><img alt='" + user + "s profile picture' src='/assets/user/" + user + ".png' /><span>User: " + user + "</span><span>By: " + auth + "</span><span>Time: " + duration[0] + " years, " + duration[1] + " days, " + duration[2] + " hours, " + duration[3] + " minutes</span><span>Reason: " + reason + "</span></div>";
    }
    function generateBanBox(user, auth, duration, reason) {
      lastSender = "<SERVER>";
      chatHTML += "<div class='msgBox'><span class='title'>Ban</span><img alt='" + user + "s profile picture' src='/assets/user/" + user + ".png' /><span>User: " + user + "</span><span>By: " + auth + "</span><span>Time: " + duration[0] + " years, " + duration[1] + " days, " + duration[2] + " hours, " + duration[3] + " minutes</span><span>Reason: " + reason + "</span></div>";
    }
    function generateWarnBox(user, auth, duration, reason) {
      lastSender = "<SERVER>";
      chatHTML += "<div class='msgBox'><span class='title'>Warn</span><img alt='" + user + "s profile picture' src='/assets/user/" + user + ".png' /><span>User: " + user + "</span><span>By: " + auth + "</span><span>Expires: " + duration[0] + " years, " + duration[1] + " days, " + duration[2] + " hours, " + duration[3] + " minutes</span><span>Reason: " + reason + "</span></div>";
    }
    socket.on("streamFeed", function(name, stream) {
      if (name !== getCookie("name")) {
        audio = new Audio();
        audio.src = stream;
        audio.loop = false;
        audio.play();
      }
    });
    socket.on("newOnlineUser", function(name) {
      if (onlineUsers.indexOf(name) !== -1) return;
      onlineUsers.push("name");
      document.getElementById("userList").innerHTML += "<div><img class='userListImg' src='/assets/user/" + name + ".png' alt='" + name + "s profile picture' /><span>" + name + "</span></div>"
    });
    function getUserColor(user) {
      //egg
      //if (user === "AUZZIE") return "pink";
      let bestColor = ["white", Infinity];
      let userRanks = userList[serverId].find(item => item.name === user);
      if (!userRanks || !userRanks.ranks.length) return "white";
      userRanks = userRanks.ranks;
      for (f = 0; f<userRanks.length; f++) {
        if (userRanks[f].level < bestColor[1]) {
          bestColor = [userRanks[f].color, userRanks[f].level];
        }
      }
      return bestColor[0];
    }
    function showHome(elm) {
      serverId = -1;
      let serverIcons = Array.from(document.getElementsByClassName("serverIcon"));
      serverIcons.forEach(icon => icon.className = "serverIcon");
      elm.className = "serverIcon serverIconSelected";
      document.getElementById("channels").innerText = "";
      document.getElementById("serverActions").style.display = "none";
      document.getElementById("userList").style.display = "none";
      document.getElementById("msgBox").style.display = "none";
      document.getElementById("messages").style.display = "none";
      document.getElementById("home").style.display = "block";
      document.getElementById("serverName").innerText = "Unnamed Chat";
    }
    function addMsg(sender, msg, time) {
      tag = "";
      //if (sender === "AUZZIE") tag = "[PINK] ";
      if (lastSender !== sender) {
        if (new Date(time).getDate() !== new Date().getDate() || new Date(time).getMonth() !== new Date().getMonth() || new Date(time).getYear() !== new Date().getYear()) {
          formatTime = new Intl.DateTimeFormat('en-AU', {month: 'long', day: 'numeric'}).format(time) + " at ";
        } else {
          formatTime = "Today at ";
        }
        formatTime += new Intl.DateTimeFormat('en-AU', {hour: 'numeric', minute: 'numeric', hour12: true}).format(time);
        chatHTML += "<div class='newSender'><img class='profilePic' src='/assets/user/" + sender + ".png' alt='" + sender + "s profile picture' onerror='this.src=\"/assets/logo.png\"' /><div class='topLine'><span style='color:" + getUserColor(sender) + "; font-weight: 500;'>" + tag + sender + " </span><span class='disclaimer'>" + formatTime + "</span></div><div class='messageText'>" + msg + "</div></div>";
        lastSender = sender;
      } else {
       chatHTML += "<div class='messageText'>" + msg + "</div>";
      }
    }
    socket.on("linkResponse", function(state, server) {
      if (state) {
        if (server) {
          let elm = document.getElementById('serverBar').innerHTML += "<img src='/assets/server/" + server + ".png' class='serverIcon' alt='server icon' onclick='showServer(" + server + ", this)'>"
        }
        document.getElementById('selectAction').style.left = '0'; 
        document.getElementById('joinLinkEnter').style.left = '100%';
        document.getElementById("joinLinkIn").style.border = null;
        document.getElementById("joinLinkError").style.display = "none";
        closeJoinServer();
      } else {
        document.getElementById("joinLinkError").style.display = "block";
        document.getElementById("joinLinkIn").style.border = "2px solid red";
      }
    });
    socket.on("inviteLink", function(key) {;
      document.getElementById("linkInputRead").value = "unnamedchat.repl.co/invite/" + key;
      window.lastKey = "unnamedchat.repl.co/invite/" + key;
      document.getElementById("linkOptionsSlide").style.right = "100%"
      document.getElementById("linkCodeSlide").style.left = "0px";
    });
    function setServerInfo(log, mute, name, skipUp) {
      if (!skipUp) {
      lastSender = "<null>"
      //chat log
      chatHTML = "";
      for (i=0; i<log.length; i++) {
        if (log[i][0] === "msg") {
          addMsg(log[i][1], log[i][2], log[i][3]);
        } else if (log[i][0] === "mute") {
          generateMuteBox(log[i][1], log[i][2], log[i][3], log[i][4]);
        } else if (log[i][0] === "warn") {
          generateWarnBox(log[i][1], log[i][2], log[i][3], log[i][4]);
        } else if (log[i][0] === "ban") {
          generateBanBox(log[i][1], log[i][2], log[i][3], log[i][4]);
        } else {
          console.warn("[Unhandled msg type] no handler for msg type '" + log[i][0] + "'")
        }
      }
      servers[serverId].msgLog = log;
      document.getElementById("messages").innerHTML = chatHTML;
      document.getElementById("messages").scrollTop = 9999999999;
      }
      //mute
      if (mute > new Date().getTime()) {
        isMuted(mute);
      } else {
        document.getElementById("msgBox").removeAttribute("disabled");
        document.getElementById("msgBox").placeholder = "";
      }
      //server name
      document.getElementById("serverName").innerText = name;
      //channels (coming soon - todo)
      document.getElementById("channels").innerHTML = '<div class="channelLabel" style="border: 2px solid #fda50f;" onclick="openChannel(0)">Text</div><div class="channelLabel" onclick="openChannel(1)">Voice</div>';
    }
    socket.on("serverData", function(log, mute, name, id) {
      if (serverId !== id) {
        console.debug("[Slow Server] updated server data was requested for server '" + id + "' but when returned, server displayed was server '" + serverId + "' this could be caused by a slow server or the client switching servers quickly");
        return;
      }
      setServerInfo(log, mute, name, false);
    });
  </script>
  <script>
    var i;
    var shownRank;
    var rankData;
    var shownTab;
    var userListAdmin;
    var promoting;
    var userRanks;
    var nextId = 0;
    document.getElementById("rankName").oninput = function() {
      showConfirmBar();
      document.getElementsByClassName("rank")[shownRank[0]].innerText = this.value;
    }
    function getCookie(name) {
      var value = "; " + document.cookie;
      var parts = value.split("; " + name + "=");
      if (parts.length == 2) return parts.pop().split(";").shift();
    }
    function saveRankChanges() {
      awaitingSave = false;
      document.getElementById("confirmRankChange").style.bottom = "-42px";
      rankData = {};
      rankData.name = document.getElementById("rankName").value;
      rankData.canMute = document.getElementById("rankCanMute").checked;
      rankData.canEditRanks = document.getElementById("rankCanEditRanks").checked;
      rankData.color = document.getElementById("rankColor").value;
      rankData.canBan = document.getElementById("rankCanBan").checked;
      socket.emit("editRank", getCookie("name"), getCookie("pass"), socket.id, serverId, shownRank[1], rankData);
      ranksList[shownRank[1]] = rankData;
    }
    function clearCookie(name) {
      document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 GMT;";
    }
    document.getElementById("ranksLabel").onclick = function() {
      socket.emit("createRank", getCookie("name"), getCookie("pass"), socket.id, serverId);
      let nextRankPos = document.getElementById("ranksList").children.length;
      document.getElementById("ranksList").innerHTML += "<div class='rank' onclick='showRank(" + nextRankPos + "," + nextId + ")'>New Rank</div>";
      ranksList.push({
          name: "New Rank", 
          id: nextId, 
          level: nextId, 
          color: "#ffffff",
          canMute: false,
          canEditRanks: false,
          canBan: false,
      });
      showRank(nextRankPos, + nextId)
      nextId++;
    }
    function showTab(tab) {
      if (awaitingSave) {
        shakeRanksSaveBar();
        return;
      }
      for (i=0; i<document.getElementsByClassName("tab").length; i++) {
        document.getElementsByClassName("tab")[i].style.display = "none";
        document.getElementsByClassName("tabLabel")[i].style.border = "2px solid #2f2f2f";
      }
      document.getElementsByClassName("tabLabel")[tab].style.border = "2px solid #fda50f";
      if (tab === 0) {
        socket.emit("queryRanks", socket.id, serverId);
      } else if (tab === 1) {
        socket.emit("queryUserList", socket.id, serverId);
        socket.emit("queryPerms", getCookie("name"), getCookie("pass"), socket.id, serverId);
      }
      document.getElementsByClassName("tab")[tab].style.display = "inline-block";
      shownTab = tab;
    }
    function showRank(rank, id) {
      if (awaitingSave) {
        shakeRanksSaveBar();
        return;
      }
      for (i=0; i<document.getElementsByClassName("rank").length; i++) {
        document.getElementsByClassName("rank")[i].style.border = "2px solid #2f2f2f";
      }
      document.getElementsByClassName("rank")[rank].style.border = "2px solid #fda50f";
      document.getElementById("rankName").value = ranksList[rank].name;
      document.getElementById("rankCanMute").checked = ranksList[rank].canMute;
      document.getElementById("rankCanEditRanks").checked = ranksList[rank].canEditRanks;
      document.getElementById("rankColor").value = ranksList[rank].color;
      document.getElementById("rankCanBan").checked = ranksList[rank].canBan;
      shownRank = [rank, id];
    }
    if (!getCookie("name") || !getCookie("pass")) {
      window.location.href = "/?redirectTo=admin";
    }
    function mute() {
      document.getElementById("muteBox").style.display = "none";
      time = ((document.getElementById("years").value * 365 * 24 * 60 * 60) +
      (document.getElementById("days").value * 24 * 60 * 60) +
      (document.getElementById("hours").value * 60 * 60) +
      (document.getElementById("minutes").value * 60)) * 1000;
      time += new Date().getTime();
      //round to nearest minute
      time = Math.round(time/60000)*60000;
      socket.emit("mute",
        userListAdmin[actionsFor].name,
        time,
        [document.getElementById("years").value,
        document.getElementById("days").value,
        document.getElementById("hours").value,
        document.getElementById("minutes").value],
        getCookie("name"),
        getCookie("pass"),
        socket.id,
        serverId,
        document.getElementById("reason").value
      );
    }
    function ban() {
      document.getElementById("banBox").style.display = "none";
      time = ((document.getElementById("banYears").value * 365 * 24 * 60 * 60) +
      (document.getElementById("banDays").value * 24 * 60 * 60) +
      (document.getElementById("banHours").value * 60 * 60) +
      (document.getElementById("banMinutes").value * 60)) * 1000;
      time += new Date().getTime();
      //round to nearest minute
      time = Math.round(time/60000)*60000;
      socket.emit("ban",
        userListAdmin[actionsFor].name,
        time,
        [document.getElementById("banYears").value,
        document.getElementById("banDays").value,
        document.getElementById("banYears").value,
        document.getElementById("banMinutes").value],
        getCookie("name"),
        getCookie("pass"),
        socket.id,
        serverId,
        document.getElementById("banReason").value
      );
    }
    function showMuteBox() {
      document.getElementById("muting").innerText = "Muting " + userListAdmin[actionsFor].name;
      document.getElementById(hideElement).style.display = "none"
      document.getElementById("muteBox").style.display = "block";
      document.getElementById("bodyClick").style.display = "block";
      document.getElementById("bodyClick").style.pointerEvents = "auto";
      hideElement = "muteBox";
    }
    function showBanBox() {
      document.getElementById("banning").innerText = "Banning " + userListAdmin[actionsFor].name;
      document.getElementById(hideElement).style.display = "none"
      document.getElementById("banBox").style.display = "block";
      document.getElementById("bodyClick").style.display = "block";
      document.getElementById("bodyClick").style.pointerEvents = "auto";
      hideElement = "banBox";
    }
    function promote(rank) {
      socket.emit('addRank', userListAdmin[promoting].name, rank, getCookie("name"), getCookie("pass"), socket.id, serverId);
      let rankData2 = ranksList.find(rankData => rankData.id === rank);
      document.getElementsByClassName("rankTags")[promoting].innerHTML += "<div class='rankTag'>" + rankData2.name + "<div class='x' onclick=\"socket.emit('revokeRank','" + userListAdmin[promoting] + "'," + rankData2.id + "," + "getCookie('name')," + "getCookie('pass')," + "socket.id, serverId); this.parentElement.remove()\">&times;</div></div>";
    }
    function promoteMenu(user) {
      document.getElementById("promoteMenu").style.top = 100 + (74 * user) + "px";
      document.getElementById("promoteMenu").style.display = "inline-block";
      hideElement = "promoteMenu";
      document.getElementById("bodyClick").style.pointerEvents = "auto";
      socket.emit("queryRanks", socket.id, serverId);
      promoting = user;
    }
    function moreActionsMenu(user) {
      document.getElementById("moreActionsMenu").style.top = 100 + (74 * user) + "px";
      document.getElementById("moreActionsMenu").style.display = "inline-block";
      hideElement = "moreActionsMenu";
      document.getElementById("bodyClick").style.pointerEvents = "auto";
      actionsFor = user;
    }
    socket.on("accountSyncError", function() {
      clearCookie("name");
      clearCookie("pass");
      window.location.href = "/";
    });
    socket.on("allAccounts", function(list) {
      document.getElementById("adminUserList").innerHTML = "";
      userListAdmin = list;
      for (i = 0; i<list.length; i++) {
        document.getElementById("adminUserList").innerHTML += "<div><img src='/assets/user/" + list[i].name + ".png' />" + list[i].name + "<span onclick=promoteMenu(" + parseInt(i) + ");>+</span><div class='rankTags'></div><img class='moreActions' alt='more actions' src='/assets/more.png' onclick='moreActionsMenu(" + parseInt(i) + ")'/></div>";
        for (f=0; f<list[i].ranks.length; f++) {
          document.getElementsByClassName("rankTags")[i].innerHTML += "<div class='rankTag'>" + list[i].ranks[f].name + "<div class='x' onclick=\"socket.emit('revokeRank','" + list[i].name + "'," + list[i].ranks[f].id + "," + "getCookie('name')," + "getCookie('pass')," + "socket.id, serverId); this.parentElement.remove()\">&times;</div></div>";
          //end cannot be one string because of chrome bugs
        }
      }
    });
    socket.on("ranks", function(ranks) {
      ranksList = ranks;
      document.getElementById("ranksList").innerText = "";
      for (i=0; i<ranks.length; i++) {
        document.getElementById("ranksList").innerHTML += "<div class='rank' onclick='showRank(" + i + "," + ranks[i].id + ")'>" + ranks[i].name + "</div>"
        nextId = ranks[i].id+1;
      }
      if (ranks.length > 0) {
        showRank(ranks.length-1, ranks[ranks.length-1].id);
      }
      document.getElementById("promoteMenu").innerText = "";
      for (i=0; i<ranks.length; i++) {
        document.getElementById("promoteMenu").innerHTML += "<div class='rank' onclick=promote(" + ranks[i].id + ")>" + ranks[i].name + "</div>";
      }
    });
    showTab(0);
    function updateAdmin() {
      socket.emit("queryRanks", socket.id, serverId);
      socket.emit("queryUserList", socket.id, serverId);
      socket.emit("queryPerms", getCookie("name"), getCookie("pass"), socket.id, serverId)
    }
    socket.on("perms", function(perms) {
      if (perms.canMute) {
        document.getElementsByClassName("otherAction")[0].style.display = "block";
      } else {
        document.getElementsByClassName("otherAction")[0].style.display = "none";
      }
      if (perms.canKick) {
        document.getElementsByClassName("otherAction")[1].style.display = "block";
      } else {
        document.getElementsByClassName("otherAction")[1].style.display = "none";
      }
      if (perms.canBan) {
        document.getElementsByClassName("otherAction")[2].style.display = "block";
      } else {
        document.getElementsByClassName("otherAction")[2].style.display = "none";
      }
    });
  </script>
</body>
</html>